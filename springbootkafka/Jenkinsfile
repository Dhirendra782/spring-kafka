pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building Spring Boot app...'
                sh 'mvn clean package'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying Spring Boot app...'
                sh '''
                # Stop any previously running Spring Boot app
                pkill -f 'java -jar' || true

                # Start the new JAR in the background and log output
                nohup java -jar target/*.jar > app.log 2>&1 &
                '''
            }
        }
    }
}
